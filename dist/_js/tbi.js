datasets_obj = {
      figure_1: {
            class_name: "figure_1",
            // prettier-ignore
            data_values: [1.6902,1.81954,1.6902,1.81954,1.91381,1.81954,1.85733,1.79934,1.87506,1.86923,2.19033,2.24055,2.47276,2.60206,2.73078,2.6149,2.31597,1.755871,0.4624,1.53148,1.38021,1.47712,1.23045,1.07918,1,1.27875,1.39794,1.74819,1.87506,2.03743,1.97313,1.93952,2.21484,2.29447,2.04532,1.662761,0.07918,1.32222,1,0,0.477121,0.954243,0.90309,1.23045,1.20412,1.36173,1.51851,1.59106,1.86923,1.87506,1.92942,1.86332,1.88081,1.653211,0.14613,1,0.778151,0.69897,0.778151,1,0.90309,0.954243,1.07918,1.14613,0.845098,1.43136,1.66276,1.77815,1.76343,1.75587,1.66276,1.643451,0.07918,0.90309,0.477121,0.477121,0.60206,0.60206,0.845098,0.778151,1.04139,0.60206,0.90309,1.14613,1.5682,1.63347,1.83251,1.70757,1.60206,1.579780,0.90309,0.90309,0.30103,0.60206,0.845098,0.30103,0.60206,0.778151,1.11394,1.07918,1,1.23045,1.23045,1.32222,1.49136,1.65321,1.62325,1.55630,0.845098,0.30103,0.69897,0.60206,0.954243,0.845098,0.954243,0.778151,0.69897,0.69897,0.60206,1.07918,0.778151,1.23045,1.47712,1.716,1.6721,1.477120,0.477121,0.477121,0.477121,0.845098,0.69897,0.60206,0.845098,0.60206,0.778151,0.60206,0.69897,0.954243,1.14613,1.14613,1.53148,1.64345,1.62325,1.46240,0.954243,0.778151,0.778151,0.845098,0.477121,0.845098,0.60206,0.69897,0.477121,0.69897,0.845098,0.845098,1.17609,1.30103,1.34242,1.60206,1.49136,1.380211,0.04139,0.90309,0,0.778151,1,0.60206,0.477121,0.60206,1.14613,0.954243,1.07918,1.23045,1.04139,1.34242,1.32222,1.5682,1.36173,1.041390,0.845098,0.477121,0.778151,0.845098,0.845098,1.04139,0.778151,1.04139,0.477121,0.69897,0.90309,1,1.11394,1.36173,1.51851,1.36173,1.23045,1.230451,0.60206,0.778151,0.845098,0.69897,0.845098,0.60206,0.954243,0.845098,0.954243,1.07918,0.954243,0.845098,1.17609,1.38021,1.20412,1.34242,1.278751,0.14613,0.845098,0.69897,0.845098,0.778151,0.845098,0,0.60206,0.845098,1.04139,1.04139,0.778151,0.954243,1.04139,1.17609,1.44716,1.17609,1.322220,0.954243,0.845098,1,1.07918,0.845098,0.60206,0.60206,0.60206,0.90309,1.04139,1.04139,0.845098,1,1.11394,1.27875,1.39794,1.27875,1.301031,0.07918,0.845098,1.11394,1.14613,1.07918,1.07918,0.90309,0.90309,0.90309,0.90309,1.07918,0.954243,1.11394,1.30103,1.14613,1.27875,1.23045,1.342421,0.25527,0.954243,1.07918,1.17609,1.17609,1.04139,1.14613,1.17609,1.11394,1.36173,1.25527,1.14613,1.36173,1.34242,1.23045,1.39794,1.44716,1.322221,0.36173,1.23045,1.23045,1.36173,1.4624,1.27875,1.53148,1.20412,1.20412,1.32222,1.39794,1.27875,1.41497,1,1.4624,1.38021,1.36173,1.278751,0.50515,1.64345,1.64345,1.66276,1.80618,1.64345,1.76343,1.78533,1.49136,1.32222,1.44716,1.5563,1.6721,1.66276,1.62325,1.32222,1.34242,1.612781,0.49136,1.96379,2.06446,2.11727,1.96379,1.98677,1.87506,1.70757,1.69897,1.74036,2.00432,2.2014,2.15229,2.02531,1.97772,1.80618,1.73239,1.633471,0.49136,1.89763,1.51851,1.62325,1.43136,1.69897,1.64345,1.50515,1.5682,1.14613,1.30103,1.50515,1.5682,1.70757,1.6902,1.63347,1.47712,1.55631,0.47712,1.5682,1.14613,1.32222,1.27875,1.32222,1.41497,1.23045,1.04139,1.39794,1.04139,1.07918,1.14613,1.11394,1.30103,1.38021,1.36173,1.491361,0.27875,1.07918,1.25527,1.38021,1.07918,1.25527,1.25527,1,1.07918,0.954243,1,0.954243,1.11394,0.845098,0.845098,1.11394,1.38021,1.204121,0.07918,0.778151,1.04139,1.14613,1.32222,1.23045,0.954243,0.90309,0.845098,0.845098,0.90309,0.60206,0.90309,0.60206,1.07918,1.04139,1.17609,1.255271,0.23045,0.954243,0.90309,0.778151,1.17609,0.90309,0.90309,1,0.778151,1.04139,0.60206,1,0.778151,1.07918,0.845098,0.954243,1.07918,1.255271,0.04139,0.477121,0.90309,0.90309,0.30103,1,0.90309,0.778151,0.60206,0.30103,0.69897,1,1.07918,0.90309,0.954243,1.07918,1.07918,1.204121,0.04139,0.30103,0.845098,1.07918,0.90309,1,0.778151,0.477121,0.69897,0.954243,0.778151,0.60206,0.845098,1.14613,1.11394,1.20412,1.11394,1.380211,0.20412,0,1.11394,1.04139,1.14613,0.90309,0.778151,1.04139,0.845098,0.90309,0.778151,0.778151,0.954243,1,0.954243,1.20412,1.07918,1.204120,0.778151,1.07918,1.07918,0.90309,0.845098,1,0.954243,0.954243,0.845098,1.04139,1.04139,0.60206,1.04139,1.04139,1.20412,1.17609,1.36173,1.176090,0.954243,0.69897,0.778151,0.845098,1.04139,0.60206,0.90309,0.954243,0.845098,0.845098,0.845098,1.11394,1.25527,1.20412,1.32222,1.39794,1.38021,1.46241,0.23045,0.778151,0.778151,0.69897,0.954243,0.90309,0.477121,0.778151,0.954243,0.778151,0.90309,1.04139,1.23045,1.38021,1.43136,1.62325,1.39794,1.447161,0.60206,0.477121,1,0.477121,0.845098,0.60206,0.60206,1,0.954243,0.90309,1.07918,1.38021,1.44716,1.51851,1.63347,1.65321,1.447161,0.07918,0.477121,0.778151,1,0.778151,0.845098,0.778151,0.60206,0.954243,0.69897,0.90309,1.14613,1.38021,1.38021,1.78533,1.61278,1.63347,1.278750,0.954243,1.04139,0.845098,0.778151,0.954243,1.25527,1.11394,1.27875,1.32222,1.30103,1.30103,1.44716,1.57978,1.77085,1.81291,1.85126,1.63347,1.653210,0.90309,1.27875,0.90309,0.60206,1,1,1.17609,1.17609,1.17609,1.44716,1.43136,1.59106,1.81291,2.0607,2.12385,1.80618,1.86332,1.698971,0.23045,1.4624,1.25527,1.20412,0.845098,1.04139,1.41497,1.38021,1.65321,1.72428,1.83885,1.9345,2.03342,2.22272,2.11394,2.03342,1.8451,1.785331,0.51851,1.65321,1.63347,1.69897,1.62325,1.69897,1.69897,1.68124,1.75587,1.82607,2.23045,2.27646,2.32222,2.39967,2.56229,2.51983,2.27646,1.88649],
            key: "run(datasets_obj.figure_1)",
            min_force: 0.04139,
            max_force: 3 - 0.04139,
            cylinder_size: 0.12,
            name: "Fig. 1",
            scale: "cool",
            ramp:
                  "6e40aa6d41ab6d41ad6d42ae6c43af6c43b06b44b26b45b36a46b46a46b56a47b76948b86949b9684aba674abb674bbc664cbe664dbf654ec0654fc1644fc26350c36351c46252c56153c66154c76055c85f56c95f57ca5e58cb5d59cc5d5acd5c5ace5b5bcf5a5cd05a5dd0595ed1585fd25760d35661d45662d45564d55465d65366d75267d75268d85169d8506ad94f6bda4e6cda4d6ddb4d6edb4c6fdc4b70dc4a72dd4973dd4874de4775de4676de4677df4578df4479df437be0427ce0417de0407ee03f7fe13f80e13e82e13d83e13c84e13b85e13a86e13988e13889e1388ae1378be1368ce1358ee1348fe13390e13391e13292e13194e03095e02f96e02f97e02e98df2d9adf2c9bdf2c9cde2b9dde2a9ede29a0dd29a1dd28a2dc27a3dc27a4db26a6db25a7da25a8da24a9d924aad823abd822add722aed621afd621b0d520b1d420b2d41fb4d31fb5d21eb6d11eb7d01eb8d01db9cf1dbace1cbccd1cbdcc1cbecb1bbfca1bc0c91bc1c81bc2c71ac3c61ac4c51ac5c41ac6c31ac7c219c8c119c9c019cabf19cbbe19ccbc19cdbb19ceba19cfb919d0b819d1b719d2b519d3b41ad4b31ad5b21ad6b11ad7af1ad8ae1bd8ad1bd9ac1bdaaa1cdba91cdca81cdda61ddda51ddea41ddfa31ee0a11ee1a01fe19f1fe29d20e39c21e39b21e49922e59822e59723e69624e79425e79325e89226e99027e98f28ea8e29ea8c29eb8b2aeb8a2bec892cec872ded862eed852fee8430ee8231ef8132ef8033f07f35f07e36f17c37f17b38f17a39f2793bf2783cf2773df3763ef37440f37341f47242f47144f47045f46f47f56e48f56d49f56c4bf56b4cf56a4ef6694ff66851f66852f66754f66656f66557f66459f6635bf6635cf6625ef76160f76061f76063f75f65f75e66f75e68f75d6af75d6cf65c6df65c6ff65b71f65b73f65a75f65a76f65978f6597af6597cf6587ef65880f55882f55883f55785f55787f55789f5578bf4578df4578ff45791f45793f45795f35797f35798f3579af3579cf2579ef258a0f258a2f258a4f158a6f159a8f159aaf159abf05aadf05a"
      },
      figure_6: {
            class_name: "figure_6",
            // prettier-ignore
            data_values: [0,0,0,0,0,0,0.576764,0.388025,0,0,0,0,0,0,0,0,0,0.429192,0,0,0,0,0,0,0,0,0,0,0,0,0.64282,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.578045,0,0,0,0,0,0,0,0,0,0,0,0.398286,0,0,0.622713,0,0,0,0,0,0,0,0,0,0.362838,0,0,0,0,0.398286,0,0.458687,0,0,0,0,0,0.417277,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.542635,0,0,0,0,0,0,0,0,0.701365,0,0,0,0.548557,0.647642,0.375372,0,0,0,0,0.607607,0,0,0,0,0,0,0.546703,0,0,0,0,0,0,0.367165,0,0,0,0,0,0,0.843688,0,0,0,0,0.497624,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.546703,0,0.505135,0,0,0,0,0,0.364145,0,0,0,0,0,0,0,0,0,0.392243,0,0,0.466577,0,0,0,0.677535,0,0,0,0.442691,0,0,0,0,0,0,0,0,0,0,0,0,0,0.384495,0,0,0.383656,0,0,0,0,0,0,0.546703,0,0,0,0,0,0,0.364515,0,0,0,0,0,0,0,0.425235,0,0,0,0,0,0,0,0.470069,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.481194,0,0,0.385258,0,0,0,0,0,0.459434,0,0,0.65475,0,0,0.432871,0,0,0,0,0,0,0,0.378659,0,0,0.500851,0,0,0,0,0,0,0,0,0,0,0,0,0,0.40044,0,0,0,0.392374,0,0,0,0,0,0,0,0.464194,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.407923,0,0.37325,0,0.453914,0,0,0.427219,0.478333,0,0,0,0,0,0,0.402024,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.394571,0,0,0,0,0.606939,0,0,0,0.400206,0,0,0,0,0,0,0,0,0,0,0,0,0.510213,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.465375,0,0,0,0,0.527656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.416964,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.425398,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.451668,0,0,0,0,0,0.464559,0,0,0,0,0,0,0,0,0.445332,0,0,0,0.4366,0,0,0.648939,0,0,0,0,0.527241,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.518375,0,0,0,0.520672,0,0,0.436807,0,0,0,0,0,0,0,0,0,0,0.557424,0,0,0,0,0,0.712605,0,0.387122,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.444423,0,0,0,0,0,0,0,0,0,0,0,0.702011,0,0,0.4329,0,0,0,0,0.461648,0,0,0,0,0,0,0.384483,0,0,0,0,0,0,0,0,0,0.508076,0.469722,0,0,0,0,0,0],
            key: "run(datasets_obj.figure_6)",
            min_force: 0.362838,
            max_force: 1 - 0.362838,
            cylinder_size: 0.4,
            name: "Fig. 6",
            scale: "warm",
            ramp:
                  "e6002ae6002ae6002ae6002ae6002ae6002ae6002ae6002ae6002ae6002ae6002ae6002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002ae7002be7002be7002be7002be7002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be8002be9002be9002be9002be9002be9002be9002ce9002ce9002ce9002ce9002ce9002ce9002ce9002ce9012ce9022ce9032ce9052ce9062cea072cea082cea092cea0b2cea0c2cea0d2cea0e2cea0f2cea112cea122cea132cea142cea152cea162cea182dea192dea1a2dea1b2deb1c2deb1e2deb1f2deb202deb212deb222deb242deb252deb262deb272deb282deb2a2deb2b2deb2c2deb2d2deb2e2deb2f2deb312dec322dec332dec342dec352dec372dec382eec392eec3a2eec3b2eec3d2eec3e2eec3f2eec402eec412eec422eec442eec452eec462eec472eed482eed4a2eed4b2eed4c2eed4d2eed4e2eed502eed512eed522eed532eed542eed562eed572eed582fed592fed5a2fed5b2fed5d2fee5e2fee5f2fee602fee612fee632fee642fee652fee662fee672fee692fee6a2fee6b2fee6c2fee6d2fee6e2fee702fee712fee722fef732fef742fef762fef772fef7830ef7930ef7a30ef7c30ef7d30ef7e30ef7f30ef8030ef8230ef8330ef8430ef8530ef8630ef8730f08930f08a30f08b30f08c30f08d30f08f30f09030f09130f09230f09330f09530f09630f09730f09830f09931f09b31f09c31f09d31f19e31f19f31f1a031f1a231f1a331f1a431f1a531f1a631f1a831f1a931f1aa31f1ab31f1ac31f1ae31f1af31f1b031f1b131f1b231f2b331f2b531f2b631f2b731f2b831f2b932f2bb32f2bc32f2bd32f2be32f2bf32f2c132f2c232f2c332f2c432f2c532f2c732f2c832f3c932f3ca32f3cb32f3cc32f3ce32f3cf32f3d032f3d132f3d232f3d432f3d532f3d632f3d732f3d832f3da33f3db33f3dc33f3dd33f4de33f4df33f4e133f4e233f4e333f4e433f4e533f4e733f4e833"
      }
};

var azimuth = [];
var elevation = [];
var objects = [];
var selectedObject;
var azLength = 0;
var elLength = 0;
arrows = [];

var canvas_wrapper = document.querySelector(".canvas-wrapper");

settings = {
      autoRotate: true,
      autoRotateSpeed: 2,
      enablePan: false,
      enableZoom: false
};

init();

function init() {
      createScene();
      loadHelmet();

      storeAzimuthData();
      storeElevationData();

      run(datasets_obj.figure_1);
}

function run(data_set) {
      reset();

      // Change dataset list item
      document
            .querySelector("." + data_set.class_name)
            .classList.add("is-running");

      document.querySelector(".canvas-figure-label").innerHTML = data_set.name;

      if (data_set.class_name == "figure_1") {
            document.querySelector(".figure_1 .data-set-run span").innerHTML =
                  "Running";
            document.querySelector(".figure_6 .data-set-run span").innerHTML =
                  "Run model";
      } else {
            document.querySelector(".figure_1 .data-set-run span").innerHTML =
                  "Run model";
            document.querySelector(".figure_6 .data-set-run span").innerHTML =
                  "Running";
      }

      document.querySelector(".intensity-bar").classList.add(data_set.scale);

      data = data_set.data_values;

      main(data_set);
}

function createScene() {
      // Get the canvas wrapper initial size
      getSizes();

      // Setup scene
      scene = new THREE.Scene();

      // Setup camera
      camera = new THREE.PerspectiveCamera(
            75,
            sizes.width / sizes.height,
            0.1,
            1000
      );

      // Setup Renderer
      renderer = new THREE.WebGLRenderer({
            alpha: true,
            antialias: true
      });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(sizes.width, sizes.height);

      // Add the canvas to the page
      canvas_wrapper.appendChild(renderer.domElement);

      // Detect window resizing and resize canvas
      window.addEventListener("resize", setCanvasSize, false);

      // Turn on the lights
      var light = new THREE.AmbientLight(0xffffff);
      scene.add(light);
      var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
      directionalLight.position.set(0, 20, 0);
      scene.add(directionalLight);

      // Setup Orbit Controls
      controls = new THREE.OrbitControls(camera, canvas_wrapper);
      camera.position.set(80, 0, 0);
      controls.update();

      controls.autoRotate = settings.autoRotate;
      controls.autoRotateSpeed = settings.autoRotateSpeed;

      // Stop autorotating when there is an interaction
      controls.addEventListener("start", function() {
            controls.autoRotate = false;
      });

      // Disable panning model
      controls.enablePan = settings.enablePan;
      controls.enableZoom = settings.enablePan;

      // Add axes helper
      // var axesHelper = new THREE.AxesHelper(100);
      // scene.add(axesHelper);

      // Render the canvas
      var animate = function() {
            requestAnimationFrame(animate);

            controls.update();

            renderer.render(scene, camera);
      };
      animate();
}

function loadHelmet() {
      // Init a loader
      var loader = new THREE.GLTFLoader();

      // Load a glTF resource
      loader.load(
            "../_models/helmet/scene.gltf",
            function(gltf) {
                  console.log(gltf);
                  // Adjust helmet y position
                  gltf.scene.position.set(0, -17, 0);

                  scene.add(gltf.scene);
            },
            function(xhr) {
                  // console.log((xhr.loaded / xhr.total) * 100 + "% loaded");
            },
            function(error) {
                  console.log(error);
            }
      );
}

function storeAzimuthData() {
      // prettier-ignore
      var azimuth_values = [-175,-165,-155,-145,-135,-125,-115,-105,-95,-85,-75,-65,-55,-45,-35,-25,-15,-5,5,15,25,35,45,55,65,75,85,95,105,115,125,135,145,155,165,175]
      azLength = azimuth_values.length;

      azimuth = azimuth_values;
}

function storeElevationData() {
      // prettier-ignore
      var elevation_values = [-85,-75,-65,-55,-45,-35,-25,-15,-5,5,15,25,35,45,55,65,75,85];
      elLength = elevation_values.length;

      elevation = elevation_values;
}

function ramp(range) {
      // Split gradient string into hexadecimal array
      var string_to_array = range.match(/.{1,6}/g);

      return string_to_array;
}

function main(data_set) {
      var gradient_array = ramp(data_set.ramp);

      // Setup counter for each force item
      count = -1;

      data.forEach(loadArrows);

      function loadArrows(force, index) {
            var group_a = new THREE.Group();
            var group_b = new THREE.Group();

            if (force > 0.001) {
                  var normalized_force =
                        force / (data_set.max_force + data_set.min_force);
                  var height = normalized_force * 30 + 0.5;

                  var geometry = new THREE.CylinderGeometry(
                        data_set.cylinder_size,
                        data_set.cylinder_size,
                        height,
                        8
                  );

                  var color_index = Math.round(
                        normalized_force * gradient_array.length
                  );
                  var hex = "#" + gradient_array[color_index];
                  var color = new THREE.Color(hex);

                  var material = new THREE.MeshLambertMaterial({
                        color: color
                  });

                  var root = new THREE.Mesh(geometry, material);
                  root.rotation.x = Math.PI / 2;
                  root.position.z = 25 + height / 2;

                  scene.add(group_a);
                  scene.add(group_b);

                  scene.add(root);
                  group_b.add(root);

                  group_a.add(group_b);

                  arrows.push(group_a);
            }

            var azMod = 0;
            var elMod = 0;

            if (index % elLength == 0) {
                  count++;
            }

            if (azLength < 2) {
                  azMod = 1;
            } else {
                  azMod = azimuth[count];
            }

            if (elevation.length < 2) {
                  elMod = 1;
            } else {
                  elMod = elevation[index % elLength];
            }

            group_a.rotation.order = "XYZ";
            group_b.rotation.order = "ZYX";

            group_a.rotation.set(0, (azMod * Math.PI) / 180, 0);
            group_b.rotation.set((elMod * Math.PI) / 180, 0, 0);
            group_b.rotation.x = (elMod * Math.PI) / 180;
            group_a.rotation.y = (azMod * Math.PI) / 180;
      }
}

function reset() {
      // Scroll to top of element
      // document.querySelector(".canvas-wrapper").scrollIntoView({
      //     behavior: "smooth",
      //     block: "start",
      //     inline: "center"
      // });

      // Iterate through arrows in array
      arrows.forEach(function(arrow, index) {
            scene.remove(arrow);

            if (index == arrows.length - 1) {
                  // Empty the arrows array when finished iterating
                  arrows = [];

                  // Restart orbiting
                  controls.autoRotate = settings.autoRotate;
            }
      });

      // Iterate through data set list to reset their classes
      var data_sets = document.querySelectorAll(".data-set");

      document.querySelector(".intensity-bar").classList.remove("cool", "warm");

      data_sets.forEach(data_set => {
            data_set.classList.remove("is-running");
      });
}

function getSizes() {
      // Get the size of the canvas wrapper
      sizes = document.querySelector(".canvas-wrapper").getBoundingClientRect();
}

function setCanvasSize() {
      getSizes();

      // Set the size of the canvas to fill the .brain-wrapper
      camera.aspect = sizes.width / sizes.height;
      camera.updateProjectionMatrix();

      renderer.setSize(sizes.width, sizes.height);
}
