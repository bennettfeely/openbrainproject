datasets_obj = {
	data_set_1: {
		// prettier-ignore
		data_values: [0,0,0,0,0,0,0.576764,0.388025,0,0,0,0,0,0,0,0,0,0.429192,0,0,0,0,0,0,0,0,0,0,0,0,0.64282,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.578045,0,0,0,0,0,0,0,0,0,0,0,0.398286,0,0,0.622713,0,0,0,0,0,0,0,0,0,0.362838,0,0,0,0,0.398286,0,0.458687,0,0,0,0,0,0.417277,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.542635,0,0,0,0,0,0,0,0,0.701365,0,0,0,0.548557,0.647642,0.375372,0,0,0,0,0.607607,0,0,0,0,0,0,0.546703,0,0,0,0,0,0,0.367165,0,0,0,0,0,0,0.843688,0,0,0,0,0.497624,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.546703,0,0.505135,0,0,0,0,0,0.364145,0,0,0,0,0,0,0,0,0,0.392243,0,0,0.466577,0,0,0,0.677535,0,0,0,0.442691,0,0,0,0,0,0,0,0,0,0,0,0,0,0.384495,0,0,0.383656,0,0,0,0,0,0,0.546703,0,0,0,0,0,0,0.364515,0,0,0,0,0,0,0,0.425235,0,0,0,0,0,0,0,0.470069,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.481194,0,0,0.385258,0,0,0,0,0,0.459434,0,0,0.65475,0,0,0.432871,0,0,0,0,0,0,0,0.378659,0,0,0.500851,0,0,0,0,0,0,0,0,0,0,0,0,0,0.40044,0,0,0,0.392374,0,0,0,0,0,0,0,0.464194,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.407923,0,0.37325,0,0.453914,0,0,0.427219,0.478333,0,0,0,0,0,0,0.402024,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.394571,0,0,0,0,0.606939,0,0,0,0.400206,0,0,0,0,0,0,0,0,0,0,0,0,0.510213,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.465375,0,0,0,0,0.527656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.416964,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.425398,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.451668,0,0,0,0,0,0.464559,0,0,0,0,0,0,0,0,0.445332,0,0,0,0.4366,0,0,0.648939,0,0,0,0,0.527241,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.518375,0,0,0,0.520672,0,0,0.436807,0,0,0,0,0,0,0,0,0,0,0.557424,0,0,0,0,0,0.712605,0,0.387122,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.444423,0,0,0,0,0,0,0,0,0,0,0,0.702011,0,0,0.4329,0,0,0,0,0.461648,0,0,0,0,0,0,0.384483,0,0,0,0,0,0,0,0,0,0.508076,0.469722,0,0,0,0,0,0],
		name: "Data Set #1",
		class_name: "data-set-1",
		key: "run(datasets_obj.data_set_1)"
	},
	data_set_2: {
		// prettier-ignore
		data_values: [0,0,0,0,0,0,0,0.416964,0,0,0,0,0.429192,0,0,0,0,0,0,0,0,0,0,0,0.607607,0,0,0,0,0,0,0.478333,0.375372,0,0,0,0,0.425235,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.402024,0,0,0,0,0,0,0,0,0,0,0,0,0.442691,0,0.37325,0.677535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.384495,0,0,0,0,0,0,0,0,0,0.451668,0,0.546703,0,0,0.464559,0,0,0,0.520672,0,0,0,0,0,0,0,0.367165,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.385258,0,0,0,0,0,0,0,0,0,0,0,0,0,0.4329,0,0,0,0,0,0,0,0,0.392243,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.527241,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.407923,0,0,0,0,0.459434,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.648939,0,0.481194,0,0,0,0,0,0,0,0.4366,0,0.458687,0,0,0,0,0,0,0,0,0,0,0.466577,0,0,0,0.400206,0,0,0,0.508076,0,0,0,0,0,0,0,0,0,0.64282,0,0,0,0,0.546703,0,0,0,0,0,0,0,0,0,0,0,0.65475,0,0,0,0,0,0,0,0,0.647642,0,0,0.557424,0,0,0,0,0,0,0,0,0.436807,0,0,0,0,0.702011,0,0,0,0.40044,0.606939,0,0,0,0.384483,0,0,0,0.470069,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.398286,0,0,0,0,0,0,0,0,0,0,0,0.388025,0,0.469722,0,0,0,0,0,0,0,0,0,0,0.453914,0,0,0.505135,0,0,0,0.500851,0,0.417277,0,0,0,0,0,0,0,0,0,0,0,0.425398,0,0,0,0,0,0.364145,0,0,0,0,0,0,0,0.464194,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.527656,0,0,0,0,0,0,0,0,0,0.497624,0,0,0,0,0,0,0,0,0,0,0.364515,0,0,0,0,0,0,0.548557,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.392374,0,0,0,0.445332,0,0.578045,0,0,0.461648,0.510213,0,0,0.387122,0,0,0,0.432871,0,0,0,0,0,0,0,0,0,0,0,0,0.843688,0,0,0,0,0,0,0,0,0.712605,0,0,0,0,0,0,0,0.394571,0,0,0.576764,0,0,0,0,0,0,0,0,0,0,0,0.546703,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.427219,0.542635,0,0,0,0,0.622713,0,0,0,0,0,0.383656,0,0,0,0,0,0.701365,0.465375,0,0,0,0,0,0.444423,0,0,0,0,0,0,0.398286,0,0,0,0,0,0.518375,0,0,0.362838,0,0,0.378659,0],
		name: "Data Set #2",
		class_name: "data-set-2",
		key: "run(datasets_obj.data_set_2)"
	},
	data_set_3: {
		// prettier-ignore
		data_values: [0,0,0,0,0,0,0,0,0,0.375372,0,0,0,0,0.364515,0,0,0,0,0,0,0,0,0,0.364145,0,0,0,0,0,0,0.444423,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.843688,0,0.622713,0,0.4329,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.385258,0,0,0,0,0,0,0.432871,0,0,0,0,0,0,0.392374,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.425235,0,0,0,0,0,0,0,0,0.505135,0,0,0,0,0,0,0,0,0,0,0.398286,0,0,0,0,0,0.481194,0,0.436807,0,0,0,0,0,0,0,0,0,0,0,0,0,0.416964,0,0,0.500851,0,0,0,0,0,0,0,0,0,0,0,0,0,0.362838,0,0,0,0,0,0,0,0,0,0,0,0.392243,0,0,0,0.518375,0,0.527656,0,0.465375,0.470069,0,0,0,0,0,0.578045,0,0,0,0.469722,0,0,0.64282,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.387122,0,0,0,0,0,0,0,0.453914,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.464194,0,0,0.383656,0,0,0,0,0.384495,0,0,0,0.367165,0,0.427219,0,0.466577,0,0,0,0,0,0,0,0,0,0,0,0.647642,0.40044,0,0,0,0,0,0,0,0,0,0,0,0,0,0.425398,0,0,0,0,0.701365,0,0,0,0,0,0,0,0,0,0.451668,0,0,0,0.546703,0.378659,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.557424,0,0,0,0,0,0.464559,0,0.394571,0,0,0,0,0,0,0.442691,0,0,0,0.388025,0,0,0,0,0.576764,0.677535,0.478333,0,0,0,0.606939,0,0,0,0.497624,0,0,0,0,0,0.546703,0,0,0,0,0,0,0,0,0,0,0.458687,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.527241,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.429192,0,0,0.548557,0,0,0,0,0,0,0,0,0.402024,0.384483,0,0,0,0,0,0.37325,0,0,0,0,0.398286,0,0,0,0,0,0.4366,0,0,0,0,0,0,0,0,0,0,0,0,0,0.712605,0,0,0,0,0,0,0.546703,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.607607,0.648939,0.407923,0.508076,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.520672,0,0,0,0,0,0,0,0,0,0,0,0.65475,0,0,0,0,0,0,0,0,0,0,0,0.702011,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.400206,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.542635,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.510213,0,0,0,0.445332,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.459434,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.417277,0,0,0,0,0,0,0,0,0,0.461648,0,0,0,0],
		name: "Data Set #3",
		class_name: "data-set-3",
		key: "run(datasets_obj.data_set_3)"
	}
};

var azimuth = [];
var elevation = [];
var objects = [];
var selectedObject;
var azLength = 0;
var elLength = 0;
arrows = [];

var canvas_wrapper = document.querySelector(".canvas-wrapper");

settings = {
    autoRotate: true,
    autoRotateSpeed: 2,
    enablePan: false,
    enableZoom: false
};

init();

function init() {
    createScene();
    loadHelmet();

    storeAzimuthData();
    storeElevationData();

    run(datasets_obj.data_set_1);
}

function run(data_set) {
    reset();

    // Change dataset list item
    document
        .querySelector("." + data_set.class_name)
        .classList.add("is-running");

    console.log("." + data_set.class_name);

    data = data_set.data_values;

    main();
}

function createScene() {
    // Get the canvas wrapper initial size
    getSizes();

    // Setup scene
    scene = new THREE.Scene();

    // Setup camera
    camera = new THREE.PerspectiveCamera(
        75,
        sizes.width / sizes.height,
        0.1,
        1000
    );

    // Setup Renderer
    renderer = new THREE.WebGLRenderer({
        alpha: true,
        antialias: true
    });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(sizes.width, sizes.height);

    // Add the canvas to the page
    canvas_wrapper.appendChild(renderer.domElement);

    // Detect window resizing and resize canvas
    window.addEventListener("resize", setCanvasSize, false);

    // Turn on the lights
    var light = new THREE.AmbientLight(0xffffff);
    scene.add(light);
    var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight.position.set(0, 20, 0);
    scene.add(directionalLight);

    // Setup Orbit Controls
    controls = new THREE.OrbitControls(camera, canvas_wrapper);
    camera.position.set(80, 0, 0);
    controls.update();

    controls.autoRotate = settings.autoRotate;
    controls.autoRotateSpeed = settings.autoRotateSpeed;

    // Stop autorotating when there is an interaction
    controls.addEventListener("start", function() {
        controls.autoRotate = false;
    });

    // Disable panning model
    controls.enablePan = settings.enablePan;
    controls.enableZoom = settings.enablePan;

    // Add axes helper
    // var axesHelper = new THREE.AxesHelper(100);
    // scene.add(axesHelper);

    // Render the canvas
    var animate = function() {
        requestAnimationFrame(animate);

        controls.update();

        renderer.render(scene, camera);
    };
    animate();
}

function loadHelmet() {
    // Init a loader
    var loader = new THREE.GLTFLoader();

    // Load a glTF resource
    loader.load(
        "../models/helmet/scene.gltf",
        function(gltf) {
            console.log(gltf);
            // Adjust helmet y position
            gltf.scene.position.set(0, -17, 0);

            scene.add(gltf.scene);
        },
        function(xhr) {
            // console.log((xhr.loaded / xhr.total) * 100 + "% loaded");
        },
        function(error) {
            console.log(error);
        }
    );
}

function storeAzimuthData() {
    // prettier-ignore
    var azimuth_values = [-175,-165,-155,-145,-135,-125,-115,-105,-95,-85,-75,-65,-55,-45,-35,-25,-15,-5,5,15,25,35,45,55,65,75,85,95,105,115,125,135,145,155,165,175]
    azLength = azimuth_values.length;

    azimuth = azimuth_values;
}

function storeElevationData() {
    // prettier-ignore
    var elevation_values = [-85,-75,-65,-55,-45,-35,-25,-15,-5,5,15,25,35,45,55,65,75,85];
    elLength = elevation_values.length;

    elevation = elevation_values;
}

function ramp(range) {
    // Split gradient string into hexadecimal array
    var string_to_array = range.match(/.{1,6}/g);

    return string_to_array;
}

function main() {
    // Inferno gradient
    var gradient_array = ramp(
        "00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"
    );

    // Setup counter for each force item
    count = -1;

    data.forEach(loadArrows);

    function loadArrows(force, index) {
        if (force != NaN && force != "NaN") {
            var group_a = new THREE.Group();
            var group_b = new THREE.Group();

            if (force > 0.001) {
                var height = force * 30 + 0.5;

                var geometry = new THREE.CylinderGeometry(
                    0.75,
                    0.75,
                    height,
                    16
                );

                var color_index = Math.round(force * gradient_array.length);
                var hex = "#" + gradient_array[color_index];
                var color = new THREE.Color(hex);

                var material = new THREE.MeshLambertMaterial({
                    color: color
                });

                var root = new THREE.Mesh(geometry, material);
                root.rotation.x = Math.PI / 2;
                root.position.z = 25 + height / 2;

                scene.add(group_a);
                scene.add(group_b);

                scene.add(root);
                group_b.add(root);

                group_a.add(group_b);

                arrows.push(group_a);
            }

            var azMod = 0;
            var elMod = 0;

            if (index % elLength == 0) {
                count++;
            }

            if (azLength < 2) {
                azMod = 1;
            } else {
                azMod = azimuth[count];
            }

            if (elevation.length < 2) {
                elMod = 1;
            } else {
                elMod = elevation[index % elLength];
            }

            group_a.rotation.order = "XYZ";
            group_b.rotation.order = "ZYX";

            group_a.rotation.set(0, (azMod * Math.PI) / 180, 0);
            group_b.rotation.set((elMod * Math.PI) / 180, 0, 0);
            group_b.rotation.x = (elMod * Math.PI) / 180;
            group_a.rotation.y = (azMod * Math.PI) / 180;
        }
    }
}

function reset() {
    // Scroll to top of element
    // document.querySelector(".canvas-wrapper").scrollIntoView({
    //     behavior: "smooth",
    //     block: "start",
    //     inline: "center"
    // });

    // Iterate through arrows in array
    arrows.forEach(function(arrow, index) {
        scene.remove(arrow);

        if (index == arrows.length - 1) {
            // Empty the arrows array when finished iterating
            arrows = [];

            // Restart orbiting
            controls.autoRotate = settings.autoRotate;
        }
    });

    // Iterate through data set list to reset their classes
    var data_sets = document.querySelectorAll(".data-set");

    data_sets.forEach(data_set => {
        data_set.classList.remove("is-running");
    });
}

function getSizes() {
    // Get the size of the canvas wrapper
    sizes = document.querySelector(".canvas-wrapper").getBoundingClientRect();
}

function setCanvasSize() {
    getSizes();

    // Set the size of the canvas to fill the .brain-wrapper
    camera.aspect = sizes.width / sizes.height;
    camera.updateProjectionMatrix();

    renderer.setSize(sizes.width, sizes.height);
}
